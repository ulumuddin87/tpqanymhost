{% extends 'base.html' %}
{% block title %}Data Murid{% endblock %}
{% block content %}

<div class="sticky-top bg-white pb-2 pt-2 mb-2 border-bottom">
  <h3 class="mb-2">Data Murid</h3>
  <div class="d-flex flex-wrap gap-2">
    <a href="{{ url_for('add_murid') }}" class="btn btn-success btn-sm flex-fill">Tambah Murid</a>
    <a href="{{ url_for('cetak_data') }}" class="btn btn-primary btn-sm flex-fill">Cetak Semua</a>
  </div>
</div>
<!-- Form Pencarian & Filter -->
<form method="GET" class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="text" name="q" class="form-control" placeholder="Cari nama..." value="{{ search }}">
  </div>
  <div class="col-md-3">
    <select name="kelas" class="form-select">
      <option value="">Filter Kelas</option>
      {% for k in kelas_list %}
        <option value="{{ k.kelas }}" {% if filter_kelas==k.kelas %}selected{% endif %}>{{ k.kelas }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-3">
    <select name="jilid" class="form-select">
      <option value="">Filter Jilid</option>
      {% for j in jilid_list %}
        <option value="{{ j.jilid }}" {% if filter_jilid==j.jilid %}selected{% endif %}>{{ j.jilid }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">Cari / Filter</button>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle">
    <thead class="table-dark text-center">
      <tr>
        <th>ID</th>
        <th>Nama</th>
        <th>Jilid</th>
        <th>Kelas</th>
        <th>Alamat</th>
        <th>Wali Murid</th>
        <th>Wali Kelas</th>
        <th>Status Nilai</th> <!-- kolom baru -->
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for m in murid %}
      <tr>
        <td>{{ m.id }}</td>
        <td>{{ m.nama }}</td>
        <td>{{ m.jilid }}</td>
        <td>{{ m.kelas }}</td>
        <td>{{ m.alamat }}</td>
        <td>{{ m.wali_murid }}</td>
        <td>{{ m.wali_kelas }}</td>

<!-- Status Nilai -->
<td class="text-center 
  {% if m.nilai_bacaan and m.nilai_menulis and m.nilai_hafalan and m.nilai_ahlak and m.nilai_kehadiran %}
    bg-success text-white
  {% elif m.nilai_bacaan or m.nilai_menulis or m.nilai_hafalan or m.nilai_ahlak or m.nilai_kehadiran %}
    bg-warning
  {% else %}
    bg-white text-black
  {% endif %}
">
  {% if m.nilai_bacaan and m.nilai_menulis and m.nilai_hafalan and m.nilai_ahlak and m.nilai_kehadiran %}
    Lengkap
  {% elif m.nilai_bacaan or m.nilai_menulis or m.nilai_hafalan or m.nilai_ahlak or m.nilai_kehadiran %}
    Ada Kosong
  {% else %}
    Belum
  {% endif %}
</td>




        <td class="text-center">
          <a href="{{ url_for('edit_murid', id=m.id) }}" class="btn btn-sm btn-info">Edit</a>
          <a href="{{ url_for('delete_murid', id=m.id) }}" class="btn btn-sm btn-danger"
             onclick="return confirm('Yakin ingin menghapus data ini?')">Hapus</a>
          <a href="{{ url_for('biodata_murid', id=m.id) }}" class="btn btn-sm btn-primary">Biodata</a>
          <a href="{{ url_for('nilai_murid', id=m.id) }}" class="btn btn-sm btn-secondary">Nilai</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>


<script>
  // Pencarian real-time
  const searchInput = document.getElementById('searchInput');
  const table = document.getElementById('muridTable').getElementsByTagName('tbody')[0];

  searchInput.addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    for (let row of table.rows) {
      let text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? '' : 'none';
    }
  });
</script>

{% endblock %}
