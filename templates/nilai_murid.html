{% extends 'base.html' %}
{% block title %}Nilai Murid{% endblock %}
{% block content %}

<div class="card shadow-sm">
  <div class="card-header bg-success text-white">
    <h5 class="mb-0">Nilai Murid - Jilid {{ jilid }}</h5>
  </div>
  <div class="card-body">
    <ul>
      <li><b>Nama:</b> {{ murid.nama }}</li>
      <li><b>Kelas:</b> {{ murid.kelas }}</li>
      <li><b>Jilid Aktif:</b> {{ murid.jilid }}</li>
      <li><b>Wali Kelas:</b> {{ murid.wali_kelas}}</li>
    </ul>

    <h5 class="mt-4">📖 Riwayat Nilai</h5>
    <table class="table table-bordered table-striped">
      <thead class="table-light">
        <tr>
          <th>Jilid</th>
          <th>Bacaan</th>
          <th>Menulis</th>
          <th>Hafalan</th>
          <th>Ahlak</th>
          <th>Kehadiran</th>
          <th>Diskripsi</th>
          <th>Tanggal</th>
        </tr>
      </thead>
      <tbody>
        {% for n in riwayat %}
        <tr>
          <td>{{ n.jilid }}</td>
          <td>{{ n.nilai_bacaan }}</td>
          <td>{{ n.nilai_menulis }}</td>
          <td>{{ n.nilai_hafalan }}</td>
          <td>{{ n.nilai_ahlak }}</td>
          <td>{{ n.nilai_kehadiran }}</td>
          <td>{{ n.diskripsi }}</td>
          <td>{{ n.created_at.strftime("%d-%m-%Y") }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <form method="POST" id="nilaiForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nilai Membaca</label>
          <input type="number" name="bacaan" class="form-control" value="{{ murid['nilai_bacaan'] or '' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Nilai Menulis</label>
          <input type="number" name="menulis" class="form-control" value="{{ murid['nilai_menulis'] or '' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Nilai Hafalan</label>
          <input type="number" name="hafalan" class="form-control" value="{{ murid['nilai_hafalan'] or '' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Nilai Ahlak</label>
          <input type="number" name="ahlak" class="form-control" value="{{ murid['nilai_ahlak'] or '' }}">
        </div>
        <div class="col-md-6">
          <label class="form-label">Nilai Kehadiran</label>
          <input type="number" name="kehadiran" class="form-control" value="{{ murid['nilai_kehadiran'] or '' }}">
        </div>
        <div class="col-12">
          <label class="form-label">Diskripsi</label>
          <textarea name="diskripsi" rows="5" class="form-control"
            placeholder="Otomatis terisi bila dikosongkan">{{ murid['diskripsi'] or '' }}</textarea>
          <div class="form-text">Kosongkan bila ingin deskripsi otomatis berdasarkan nilai per-aspek.</div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-3">
        <a href="{{ url_for('data_murid') }}" class="btn btn-secondary">⬅ Kembali</a>
        <button type="submit" class="btn btn-success">💾 Simpan Nilai</button>
      </div>
    </form>
  </div>
</div>

<!-- ✅ SweetAlert2 CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.getElementById('nilaiForm').addEventListener('submit', function(event) {
    event.preventDefault(); // stop dulu submit otomatis

    Swal.fire({
      title: 'Apakah nilai sudah benar?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonText: '✅ Ya, Simpan',
      cancelButtonText: '❌ Belum',
      reverseButtons: true
    }).then((result) => {
      if (result.isConfirmed) {
        this.submit(); // baru kirim form kalau pilih Ya
      }
    });
  });
</script>

{% endblock %}
